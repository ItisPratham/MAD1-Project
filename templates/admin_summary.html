{% extends "base_admin_dashboard.html" %}

{% block title %}Summary{% endblock %}

{% block header %}Parking Lots Summary{% endblock %}

{% block content %}

    {% if summary_data %}
        <table class="table table-bordered table-striped text-center">
            <thead class="thead-dark">
                <tr>
                    <th>Lot Name</th>
                    <th>Total Spots</th>
                    <th>Available</th>
                    <th>Occupied</th>
                    <th>Inactive</th>
                    <th>Revenue (â‚¹)</th>
                </tr>
            </thead>
            <tbody>
                {% for data in summary_data %}
                <tr>
                    <td>{{ data.lot_name }}</td>
                    <td>{{ data.total_spots }}</td>
                    <td>{{ data.available }}</td>
                    <td>{{ data.occupied }}</td>
                    <td>{{ data.inactive }}</td>
                    <td>{{ data.revenue }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <div class="d-flex align-items-center gap-3" style="width: 100%;">
            <div class="col-6" style="height: 600px;">
                <canvas id="revenueChart" style="width: 100%; height: 100%;"></canvas>
            </div>
            <div class="col-6" style="height: 600px;">
                <canvas id="spotsChart" style="width: 100%; height: 100%;"></canvas>
            </div>
        </div>

        <script>
        const summaryData = {{ summary_data | tojson }};
        
        const lotNames = summaryData.map(i => i.lot_name);
        const revenues = summaryData.map(i => i.revenue);
        const available = summaryData.map(i => i.available);
        const occupied = summaryData.map(i => i.occupied);
        const inactive = summaryData.map(i => i.inactive);
        
            new Chart(document.getElementById('revenueChart'), {
                type: 'pie',
                data: {
                    labels: lotNames,
                    datasets: [
                        {
                            data: revenues
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Revenue by Lot'
                        }
                    }
                }
            });

            new Chart(document.getElementById('spotsChart'), {
                type: 'bar',
                data: {
                    labels: lotNames,
                    datasets: [
                        {
                            label: 'Available',
                            data: available,
                            backgroundColor: '#90EE90'
                        },
                        {
                            label: 'Occupied',
                            data: occupied,
                            backgroundColor: '#FFF380'
                        },
                        {
                            label: 'Inactive',
                            data: inactive,
                            backgroundColor: '#C0C0C0'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Parking Lots'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Spots'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Spot Availability Overview'
                        }
                    },
                }
            });
        </script>

    {% else %}
        <div class="text-center mb-4">
            <strong style="background-color: aliceblue;">No Data present, hence Summary and Charts cant be created.</strong>
        </div>
    {% endif %}

{% endblock %}
